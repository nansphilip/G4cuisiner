generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model User {
    id            String  @id @unique
    name          String
    email         String  @unique
    emailVerified Boolean
    image         String?
    role          Role    @default(USER)

    // One to Many
    Session Session[]
    Account Account[]
    Recipe Recipe[]

    // Many to Many (explicit)
    RecipeUser RecipeUser[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("user")
}

enum Role {
    USER
    MODO
    ADMIN
}

model Session {
    id        String   @id @unique
    expiresAt DateTime
    ipAddress String?
    userAgent String?

    // Many to One
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("session")
}

model Account {
    id         String @id @unique
    accountId  String
    providerId String

    // Many to One
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    accessToken  String?
    refreshToken String?
    idToken      String?
    expiresAt    DateTime?
    password     String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("account")
}

model Ingredient {
    id          String  @id @unique @default(uuid())
    name        String  @unique
    description String
    image       String?

    // Many to Many (explicit)
    RecipeIngredient RecipeIngredient[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Recipe {
    id          String  @id @unique @default(uuid())
    title       String  @unique
    slug        String  @unique
    description String
    image       String?

    numberOfServing Int? // in person
    preparationTime Int? // in minutes

    difficultyLevel Difficulty @default(MEDIUM)
    lunchType       LunchType
    lunchStep       LunchStep

    // Many to One
    userId String
    user   User   @relation(fields: [userId], references: [id])

    // Many to Many (explicit)
    RecipeIngredient RecipeIngredient[]
    RecipeUser RecipeUser[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

enum Difficulty {
    EASY
    MEDIUM
    HARD
}

enum LunchType {
    BREAKFAST
    LUNCH
    BRUNCH
    DINNER
    SNACK
}

enum LunchStep {
    APPETIZER
    STARTER
    MAIN
    DESSERT
}

model RecipeUser {
    @@id([recipeId, userId])
    favorite Boolean?
    rating Int? // from 0 to 5

    recipeId String
    recipe   Recipe @relation(fields: [recipeId], references: [id])

    userId String
    user   User   @relation(fields: [userId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model RecipeIngredient {
    @@id([recipeId, ingredientId])
    quantity Float
    unit Unit

    // Many to One
    recipeId     String
    recipe       Recipe     @relation(fields: [recipeId], references: [id])

    // Many to One
    ingredientId String
    ingredient   Ingredient @relation(fields: [ingredientId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

enum Unit {
    GRAM
    KILOGRAM
    LITER
    CENTILITER
    MILLILITER
    PIECE
}

// Example
model Fruit {
    id          String @id @unique @default(uuid())
    name        String @unique
    description String
    image       String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
